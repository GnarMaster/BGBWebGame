<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>BGB Web Game</title>
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background: #121212;
            color: #fff;
            text-align: center;
            padding: 40px 20px;
        }

        .title {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 16px;
            opacity: 0.8;
            margin-bottom: 30px;
        }

        .menu {
            max-width: 400px;
            margin: 0 auto;
        }

        .btn {
            display: block;
            background: #5865F2;
            padding: 15px;
            margin: 12px 0;
            border-radius: 10px;
            color: white;
            text-decoration: none;
            font-size: 18px;
            transition: 0.2s;
        }

        .btn:hover {
            background: #4752C4;
        }

        .logout-btn {
            background: #ff4e4e !important;
        }

        .logout-btn:hover {
            background: #d93c3c !important;
        }

        .profile-box {
            background: #1D1D1D;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
        }
    </style>
</head>
<body>

    <h1 class="title">ğŸ”¥ BGB Web Game</h1>
    <p class="subtitle">ë””ìŠ¤ì½”ë“œ ê²½í—˜ì¹˜ + ì›¹ê²Œì„ ì „íˆ¬ ì‹œìŠ¤í…œ</p>

    <div class="profile-box" id="profileBox">
        <p>ğŸ”‘ ì•„ì§ ë¡œê·¸ì¸í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</p>
        <a class="btn" href="https://message-tracker-1.onrender.com/login">ğŸ”‘ Discord ë¡œê·¸ì¸</a>
    </div>

    <div class="menu">
        <button class="btn" onclick="attack()">âš” ê³µê²©í•˜ê¸°</button>
        <button class="btn" onclick="skill()">ğŸ—¡ ìŠ¤í‚¬ ì‚¬ìš©</button>
        <button class="btn" onclick="boss()">ğŸ‘¹ ë³´ìŠ¤ ê³µê²©</button>
        <button class="btn" onclick="enhance()">âš’ ë¬´ê¸° ê°•í™”</button>
        <button class="btn" onclick="inventory()">ğŸ’ ì¸ë²¤í† ë¦¬</button>
        <button class="btn" onclick="checkIn()">ğŸ“… ì¶œì„í•˜ê¸°</button>
    </div>

<script>
// URLë¡œë¶€í„° ë¡œê·¸ì¸ í›„ ì „ë‹¬ëœ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
const url = new URL(window.location.href);
const user_id = url.searchParams.get("id");
const username = url.searchParams.get("name");
const avatar = url.searchParams.get("avatar");

// ë¡œê·¸ì¸ ì„±ê³µ ì‹œ localStorage ì €ì¥
if (user_id) {
    localStorage.setItem("user_id", user_id);
    localStorage.setItem("username", username);
    localStorage.setItem("avatar", avatar);

    // URL ì •ë¦¬
    history.replaceState({}, "", "/BGBWebGame/");
}

// ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥
function logout() {
    localStorage.removeItem("user_id");
    localStorage.removeItem("username");
    localStorage.removeItem("avatar");

    // í™”ë©´ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
    location.reload();
}
</script>

<script>
// Google Sheetsì—ì„œ ìœ ì € ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
async function loadUserInfo() {
    const id = localStorage.getItem("user_id");
    if (!id) return;

    const res = await fetch(`https://message-tracker-1.onrender.com/api/userinfo?user_id=${id}`);
    const data = await res.json();

    if (data.error) return;

    // HTML UI êµ¬ì„±
    document.getElementById("profileBox").innerHTML = `
        <p>ğŸ‘¤ ${localStorage.getItem("username")} ë‹˜</p>
        <img src="https://cdn.discordapp.com/avatars/${id}/${localStorage.getItem("avatar")}.png"
             style="width:80px;border-radius:50%;margin-top:10px;">
        <p>ğŸ… ì§ì—…: ${data.job}</p>
        <p>ğŸ“ˆ ë ˆë²¨: ${data.level}</p>
        <p>âœ¨ ê²½í—˜ì¹˜: ${data.exp} / ${data.next_exp}</p>

        <button class="btn logout-btn" onclick="logout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
    `;
}

loadUserInfo();
</script>

<script>
// ì¶œì„í•˜ê¸° ë²„íŠ¼ ë™ì‘
async function checkIn() {
    const id = localStorage.getItem("user_id");
    if (!id) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");

    const res = await fetch(`https://message-tracker-1.onrender.com/api/checkin?user_id=${id}`);
    const data = await res.json();

    alert(data.message);
}

// ë‹¤ë¥¸ ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„
function attack(){ alert("ì•„ì§ êµ¬í˜„ ì•ˆë¨"); }
function skill(){ alert("ì•„ì§ êµ¬í˜„ ì•ˆë¨"); }
function boss(){ alert("ì•„ì§ êµ¬í˜„ ì•ˆë¨"); }
function enhance(){ alert("ì•„ì§ êµ¬í˜„ ì•ˆë¨"); }
function inventory(){ alert("ì•„ì§ êµ¬í˜„ ì•ˆë¨"); }
</script>

</body>
</html>
